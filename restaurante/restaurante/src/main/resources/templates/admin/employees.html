<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <title>Empleados Registrados</title>

    <!-- CDN TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">

<div class="bg-white shadow-lg rounded-2xl w-full max-w-4xl p-8">

    <h1 class="text-3xl font-semibold text-gray-800 text-center mb-8">
        Empleados Registrados
    </h1>

    <!-- Barra de búsqueda -->
    <div class="flex justify-end mb-4">
        <input id="searchInput" type="text"
               placeholder="Buscar por nombre, usuario, email o rol"
               class="border border-gray-300 rounded-lg px-4 py-2 w-72 shadow-sm focus:ring focus:ring-gray-300 focus:outline-none">
    </div>

    <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-xl shadow-sm">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-700">ID</th>
                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-700">Nombre completo</th>
                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-700">Usuario</th>
                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-700">Email</th>
                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-700">Rol</th>
                    <th class="px-6 py-3 text-left text-sm font-medium text-gray-700">Acciones</th>
                </tr>
            </thead>

            <tbody id="employeesBody">
                <tr th:each="emp : ${workers}"
                    th:id="'worker-' + ${emp.id}"
                    class="border-t hover:bg-gray-50 transition">
                    <td class="px-6 py-3 text-gray-700" th:text="${emp.id}"></td>
                    <td class="px-6 py-3 text-gray-700" th:text="${emp.fullName}"></td>
                    <td class="px-6 py-3 text-gray-700" th:text="${emp.username}"></td>
                    <td class="px-6 py-3 text-gray-700" th:text="${emp.email}"></td>
                    <td class="px-6 py-3 text-gray-700" th:text="${emp.role}"></td>

                    <!-- Botón eliminar -->
                    <td class="px-6 py-3">
                        <button th:onclick="'confirmDelete(' + ${emp.id} + ')'"
                                class="text-red-600 font-semibold hover:text-red-800">
                            Eliminar
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Botón Regresar -->
    <div class="text-center mt-8">
        <a href="/admin/menu"
           class="px-4 py-2 bg-gray-700 text-white rounded-full shadow hover:bg-gray-800 transition text-xl">
            &#8592; Regresar
        </a>
    </div>

</div>

<!-- Scripts -->
<script>
    // Eliminar empleado por fetch DELETE
    function confirmDelete(id) {
        if (!confirm("¿Eliminar empleado permanentemente?")) return;

        fetch("/admin/employees/" + id, {
            method: "DELETE"
        }).then(r => {
            if (r.ok) {
                document.getElementById("worker-" + id).remove();
            } else {
                alert("Error al eliminar el empleado.");
            }
        });
    }

    // Filtro rápido (nombre, usuario, email, rol)
    document.getElementById("searchInput").addEventListener("input", e => {
        const q = e.target.value.toLowerCase();

        document.querySelectorAll("#employeesBody tr").forEach(tr => {
            const txt = tr.innerText.toLowerCase();
            tr.style.display = txt.includes(q) ? "" : "none";
        });
    });
</script>

</body>
</html>
